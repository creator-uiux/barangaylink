services:
  # BarangayLink PHP Application
  - type: web
    name: barangaylink-app
    runtime: php
    env: php
    region: singapore
    plan: free
    buildCommand: composer install --no-dev --optimize-autoloader
    startCommand: php -S 0.0.0.0:$PORT -t .
    healthCheckPath: /
    
    envVars:
      # Application Environment
      - key: APP_ENVIRONMENT
        value: production
      
      # Database Configuration (use Render MySQL)
      - key: DB_HOST
        fromDatabase: barangaylink-db
        property: host

      - key: DB_NAME
        fromDatabase: barangaylink-db
        property: database

      - key: DB_USER
        fromDatabase: barangaylink-db
        property: username

      - key: DB_PASS
        fromDatabase: barangaylink-db
        property: password
      
      - key: DB_CHARSET
        value: utf8mb4
      
      # Admin Credentials
      - key: ADMIN_EMAIL
        value: admin@barangaylink.gov.ph
      
      - key: ADMIN_PASSWORD
        sync: false  # This should be set in Render Dashboard as a secret
      
      # Session Configuration
      - key: SESSION_SECURE
        value: 1
      
      # PHP Configuration
      - key: PHP_VERSION
        value: "8.1"
      
      - key: DOCUMENT_ROOT
        value: /opt/render/project/src
    
    # Disk storage for uploaded files
    disk:
      name: barangaylink-storage
      mountPath: /opt/render/project/src/uploads
      sizeGB: 1

  # MySQL Database (Optional - only if you want Render-hosted database)
  # Uncomment if you want to use Render's MySQL service
  # - type: mysql
  #   name: barangaylink-db
  #   plan: free
  #   databaseName: barangaylink_db
  #   databaseUser: barangaylink_user
  #   region: singapore
  #   ipAllowList: []  # Empty means accessible from all Render services
